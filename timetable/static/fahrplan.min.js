function incrementHour(a){parseInt(hourInput.value)+a>23?(incrementDate(1),hourInput.value="00"):parseInt(hourInput.value)+a<0?(incrementDate(-1),hourInput.value=23):hourInput.value=z(parseInt(hourInput.value)+a)}function incrementMinute(a){parseInt(minuteInput.value)+10*a>50?(incrementHour(1),minuteInput.value="00"):parseInt(minuteInput.value)+10*a<0?(incrementHour(-1),minuteInput.value="50"):minuteInput.value=z((parseInt(parseInt(minuteInput.value)/10)+a)%6*10)}function incrementDate(a){var b=new Date(0);b.setMilliseconds(realDate.setDate(realDate.getDate()+a)),dateInput.value=formatDate(b),realDate=b}function switch_locations(){var a=document.getElementById("from"),b=document.getElementById("to"),c=a.value;a.value=b.value,b.value=c}function formatTime(a){var b=new Date(0);b.setSeconds(a);var c=b.getHours(),d=b.getMinutes();return d=d<10?"0"+d:d,c+":"+d}function formatDuration(a){return new Date(1e3*a).toISOString().substr(11,5)}function formatDate(a){return z(a.getDate())+"."+z(a.getMonth()+1)+"."+a.getFullYear()}function z(a){return a<10?"0"+a:a}function formatPlatform(a){return a?"Gl. "+a:""}function toggleConnectionDetails(a){var b=document.getElementById("con_details_"+a);b.style.display="none"==b.style.display?"":"none";var c=document.getElementById("show_detail_button_"+a);c.innerHTML="+"==c.innerHTML?"-":"+"}function initTimeSelect(){var a=new Date;dateInput=document.getElementById("date"),hourInput=document.getElementById("hour"),minuteInput=document.getElementById("minute"),dateInput.value=formatDate(a),realDate=a,hourInput.value=z(a.getHours()),minuteInput.value=z(a.getMinutes())}function getMidnightTime(a){var b=a.getTime()/1e3;return b-b%86400}function getCapacityIcon(a,b){switch(a){case 1:return'<div class="mod_timetable_occupancy_item var_low "><div class="klasse">'+b+'.</div><svg class="mod_svgsprite_icon var_SBB_utilization_low" role="img"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/static/icons.svg#SBB_utilization_low"></use></svg></div>';case 2:return'<div class="mod_timetable_occupancy_item var_medium"><div class="klasse">'+b+'.</div><svg class="mod_svgsprite_icon var_SBB_utilization_medium" role="img"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/static/icons.svg#SBB_utilization_medium"></use></svg></div>';case 3:return'<div class="mod_timetable_occupancy_item var_high"><div class="klasse">'+b+'.</div><svg class="mod_svgsprite_icon var_SBB_utilization_high" role="img"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/static/icons.svg#SBB_utilization_high"></use></svg></div>'}}function addTitleRow(a,b,c){var d=-1;c||(d=0);var e=a.insertRow(d),f=e.insertCell(0);e.className="title_row",f.colSpan=4,f.innerHTML='<p class="connection_title">'+b+"</p>"}function addContentRow(a,b,c,d){var e=-1,f=-1;d||(e=0,f=1);var g=a.insertRow(e),h=g.insertCell(0),i=g.insertCell(1),j=g.insertCell(2),k=g.insertCell(3);h.innerHTML='<p class="time">'+formatTime(b.departureTimestamp)+"</p><p>"+formatPlatform(b.platform)+"</p>",i.innerHTML='<p class="time">'+formatDuration(b.arrivalTimestamp-b.departureTimestamp)+"</p><p>Umst.: "+b.transfers+"</p>",b.capacity1st&&(j.innerHTML=getCapacityIcon(b.capacity2nd,2)+getCapacityIcon(b.capacity1st,1)),k.innerHTML='<p class="time">'+formatTime(b.arrivalTimestamp)+'</p><p><button id="show_detail_button_'+c+'" class="show_details" onclick="toggleConnectionDetails(\''+c+"')\">+</button></p>";var l=a.insertRow(f),m=l.insertCell(0);l.className="connection_details_row",m.colSpan=4,m.innerHTML='<div class="connection_details" style="display: none" id="con_details_'+c+'"></div>'}function addConnectionDetail(a,b){var c='<p class="time">'+formatTime(b.from_time)+"</p>";c+='<p class="platform">'+formatPlatform(b.from_platform)+"</p>",c+="<p>"+b.route,b.capacity1st&&(c+=getCapacityIcon(b.capacity2nd,2)+getCapacityIcon(b.capacity1st,1)),c+="</p>",c+='<p class="italic">'+formatDuration(b.to_time-b.from_time)+"</p>",c+='<p class="time">'+formatTime(b.to_time)+"</p>",c+='<p class="platform">'+formatPlatform(b.to_platform)+"</p>",a.innerHTML+='<div class="location">'+b.from+'</div><div class="connection_details_route">'+c+"</div>"}function addNextButton(a,b){var c=a.insertRow(-1),d=c.insertCell(0);d.colSpan=4,d.style.backgroundColor="#fff",d.innerHTML='<button onclick="do_query('+b+', true)" class="query_button">Sp&auml;ter</button>'}function addPrevButton(a,b){var c=a.insertRow(0),d=c.insertCell(0);d.colSpan=4,d.style.backgroundColor="#fff",d.innerHTML='<button onclick="do_query('+b+', false)" class="query_button">Fr&uuml;her</button>'}function processConnection(a,b,c,d,e){var f=b[e];d?(addTitleRow(a,f.name,d),addContentRow(a,f,c+"_"+e,d)):(addContentRow(a,f,c+"_"+e,d),addTitleRow(a,f.name,d));var g=document.getElementById("con_details_"+c+"_"+e);g.innerHTML="";for(var h=0;h<f.sections.length;h++){addConnectionDetail(g,f.sections[h])}g.innerHTML+='<div class="location">'+f.to+"</div>"}function do_query(a,b){var c=document.getElementById("results"),d=!0;if(0==a){c.innerHTML="";var e=getMidnightTime(realDate)+3600*(parseInt(hourInput.value)-1)+60*parseInt(minuteInput.value)}else{d=!1;var e=a}var f=document.getElementById("from").value.split("/").join("$.$"),g=document.getElementById("to").value.split("/").join("$.$"),h=b?0:1;if(f.length>1&&g.length>1){var i=document.getElementById("connections");"none"==i.style.display&&(i.style.display="block");var j=new XMLHttpRequest;j.open("GET","connection/"+e+"/"+h+"/"+f+"/"+g,!0),j.onload=function(a){if(b?c.deleteRow(-1):c.deleteRow(0),200==a.target.status){var f=JSON.parse(a.target.response);if(b){d&&addPrevButton(c,f.prevTime);for(var g=0;g<f.connections.length;g++)processConnection(c,f.connections,e,b,g);addNextButton(c,f.nextTime)}else{for(var g=f.connections.length-1;g>=0;g--)processConnection(c,f.connections,e,b,g);addPrevButton(c,f.prevTime)}}else alert("Keine Verbindungen gefunden")},j.send()}}var dateInput,hourInput,minuteInput,realDate;initTimeSelect(),new autoComplete({selector:"#from",minChars:2,source:function(a,b){var c=new XMLHttpRequest;c.open("GET","query/"+a,!0),c.onload=function(a){b(JSON.parse(a.target.response))},c.send()}}),new autoComplete({selector:"#to",minChars:2,source:function(a,b){var c=new XMLHttpRequest;c.open("GET","query/"+a,!0),c.onload=function(a){b(JSON.parse(a.target.response))},c.send()}});